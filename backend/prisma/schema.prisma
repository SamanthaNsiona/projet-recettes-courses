generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  Int            @id @default(autoincrement())
  name                String
  email               String         @unique
  password            String
  role                String         @default("USER")
  resetPasswordToken  String?
  resetPasswordExpiry DateTime?
  recipes             Recipe[]       @relation("UserRecipes")
  lists               ShoppingList[]
  ingredients         Ingredient[]
  favorites           Favorite[]
}

model Recipe {
  id              Int          @id @default(autoincrement())
  title           String
  description     String?
  ingredients     String // texte simple
  steps           String // texte simple
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  isPublic        Boolean      @default(false)
  userId          Int
  user            User         @relation("UserRecipes", fields: [userId], references: [id])
  ingredientsList Ingredient[]
  favorites       Favorite[]
}

model Favorite {
  id        Int      @id @default(autoincrement())
  userId    Int
  recipeId  Int
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  recipe    Recipe   @relation(fields: [recipeId], references: [id], onDelete: Cascade)

  @@unique([userId, recipeId])
}


model Ingredient {
  id       Int     @id @default(autoincrement())
  name     String
  unit     String?
  quantity Float?
  recipe   Recipe? @relation(fields: [recipeId], references: [id])
  recipeId Int?
  user     User?   @relation(fields: [userId], references: [id])
  userId   Int?
}

model ShoppingList {
  id     Int            @id @default(autoincrement())
  title  String
  user   User           @relation(fields: [userId], references: [id])
  userId Int
  items  ShoppingItem[]
}

model ShoppingItem {
  id       Int          @id @default(autoincrement())
  name     String
  quantity Float?
  unit     String?
  checked  Boolean      @default(false)
  list     ShoppingList @relation(fields: [listId], references: [id], onDelete: Cascade)
  listId   Int
}
